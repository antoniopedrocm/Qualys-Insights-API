<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qualys Security Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app-container">
    <!-- Barra Lateral de NavegaÃ§Ã£o -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1>ğŸ›¡ï¸ Q-Insights</h1>
        <span>by Patmos Cyber</span>
      </div>
      <ul class="nav-tabs">
        <li><button class="tab-btn active" onclick="showTab('dashboard')">ğŸ“Š Dashboard Executivo</button></li>
        <li><button class="tab-btn" onclick="showTab('vulnerabilities')">ğŸ”´ AnÃ¡lise de Vulnerabilidades</button></li>
        <li><button class="tab-btn" onclick="showTab('hosts')">ğŸ’» InventÃ¡rio de Hosts</button></li>
        <li><button class="tab-btn" onclick="showTab('scans')">ğŸ” Status dos Scans</button></li>
        <li><button class="tab-btn" onclick="showTab('api')">âš™ï¸ API Explorer</button></li>
      </ul>
    </nav>

    <!-- ConteÃºdo Principal -->
    <main class="main-content">
      <header class="main-header">
        <h2 id="pageTitle">Dashboard Executivo</h2>
        <div class="header-actions">
          <button class="btn" id="refreshButton" onclick="loadDashboard()">ğŸ”„ Atualizar</button>
          <button class="btn btn-secondary" onclick="exportExcel()">ğŸ“Š Exportar Excel</button>
          <button class="btn btn-secondary" onclick="exportCSV()">ğŸ“„ Exportar CSV</button>
        </div>
      </header>

      <div id="messages"></div>
      
      <div id="loadingIndicator" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>Carregando dados...</p>
      </div>

      <!-- ====================== -->
      <!-- TAB: DASHBOARD         -->
      <!-- ====================== -->
      <div id="dashboard" class="tab-content active">
        <!-- KPIs Principais -->
        <div class="kpi-grid">
          <div class="stat-card">
            <h3>Total de Hosts</h3>
            <div class="value" id="totalHosts">-</div>
          </div>
          <div class="stat-card">
            <h3>Total de Vulnerabilidades</h3>
            <div class="value" id="totalVulns">-</div>
          </div>
          <div class="stat-card sev-critical">
            <h3>CrÃ­ticas</h3>
            <div class="value" id="criticalVulns">-</div>
          </div>
          <div class="stat-card sev-high">
            <h3>Altas</h3>
            <div class="value"T" id="highVulns">-</div>
          </div>
        </div>

        <!-- GrÃ¡ficos Executivos -->
        <div class="charts-grid-col-2">
          <div class="chart-container">
            <h2>DistribuiÃ§Ã£o por Severidade</h2>
            <div class="chart-wrapper">
              <canvas id="severityChart"></canvas>
            </div>
          </div>
          
          <div class="chart-container">
            <h2>TendÃªncia de Descobertas (Novas)</h2>
            <div class="chart-wrapper">
              <canvas id="trendsChart"></canvas>
            </div>
          </div>
        </div>

        <!-- GrÃ¡ficos por Ambiente -->
        <h2 class="section-title">Vulnerabilidades por Ambiente (CrÃ­ticas, Altas, MÃ©dias)</h2>
        <div class="charts-grid-col-3">
          <div class="chart-container">
            <h2>ğŸ”§ Desenvolvimento e Qualidade</h2>
            <canvas id="devQAChart"></canvas>
          </div>
          
          <div class="chart-container">
            <h2>âš ï¸ ProduÃ§Ã£o Baixa</h2>
            <canvas id="prdBaixaChart"></canvas>
          </div>
          
          <div class="chart-container">
            <h2>ğŸ”´ ProduÃ§Ã£o Alta</h2>
            <canvas id="prdAltaChart"></canvas>
          </div>
        </div>
        
        <div class="chart-container">
          <h2>Top 10 Vulnerabilidades (QIDs)</h2>
          <div class="chart-wrapper-large">
            <canvas id="topVulnsChart"></canvas>
          </div>
        </div>
      </div>

      <!-- ====================== -->
      <!-- TAB: VULNERABILIDADES  -->
      <!-- ====================== -->
      <div id="vulnerabilities" class="tab-content">
        <div class="filter-section modern">
          <div class="filter-header">
            <div>
              <p class="eyebrow">SeguranÃ§a</p>
              <h3>Filtros de SeguranÃ§a</h3>
              <p class="filter-subtitle">Combine severidade, busca rÃ¡pida e tags para refinar a lista.</p>
            </div>
            <div class="filter-actions">
              <button class="btn btn-secondary" onclick="clearFilters()">ğŸ—‘ï¸ Limpar</button>
              <button class="btn" onclick="exportFiltered()">ğŸ“¥ Exportar CSV</button>
            </div>
          </div>

          <div class="filter-grid enhanced">
            <div class="filter-card severity-card">
              <div class="filter-card-title">Severidade</div>
              <div class="checkbox-group pill-group">
                <label class="pill critical"><input type="checkbox" class="severity-filter" value="5" checked onchange="applyFilters()"><span>CrÃ­tica</span></label>
                <label class="pill high"><input type="checkbox" class="severity-filter" value="4" checked onchange="applyFilters()"><span>Alta</span></label>
                <label class="pill medium"><input type="checkbox" class="severity-filter" value="3" checked onchange="applyFilters()"><span>MÃ©dia</span></label>
                <label class="pill low"><input type="checkbox" class="severity-filter" value="2" checked onchange="applyFilters()"><span>Baixa</span></label>
                <label class="pill info"><input type="checkbox" class="severity-filter" value="1" checked onchange="applyFilters()"><span>Info</span></label>
              </div>
            </div>

            <div class="filter-card">
              <div class="filter-card-title">Busca RÃ¡pida</div>
              <p class="filter-hint">Busque por IP, DNS, tÃ­tulo, QID, CVE ou soluÃ§Ã£o.</p>
              <div class="input-with-icon">
                <span>ğŸ”</span>
                <input type="text" id="quickSearch" placeholder="Digite para filtrar" oninput="applyFilters()">
              </div>
            </div>

            <div class="filter-card">
              <div class="filter-card-title">Tags do Host</div>
              <p class="filter-hint">Selecione uma tag cadastrada para filtrar os resultados.</p>
              <select id="tagFilter" onchange="applyFilters()">
                <option value="">Todas as Tags</option>
              </select>
            </div>

            <div class="filter-card">
              <div class="filter-card-title">Status e QID</div>
              <div class="dual-inputs">
                <div class="input-with-icon compact">
                  <span>ğŸ†”</span>
                  <input type="text" id="filterQid" placeholder="Buscar por QID" oninput="applyFilters()">
                </div>
                <div class="input-with-icon compact">
                  <span>ğŸ“Š</span>
                  <select id="filterStatus" onchange="applyFilters()">
                    <option value="">Todos os Status</option>
                    <option value="New">Novo</option>
                    <option value="Active">Ativo</option>
                    <option value="Re-Opened">Reaberto</option>
                    <option value="Fixed">Corrigido</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="table-header">
            <div>
              <p class="eyebrow">Lista</p>
              <h2>Vulnerabilidades (<span id="vulnCount">0</span> de <span id="vulnTotal">0</span>)</h2>
            </div>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Host IP</th>
                  <th>DNS</th>
                  <th>Sistema Operacional</th>
                  <th>QID</th>
                  <th>TÃ­tulo</th>
                  <th>Severidade</th>
                  <th>Status</th>
                  <th>Porta</th>
                  <th>Protocolo</th>
                  <th>SoluÃ§Ã£o</th>
                  <th>Resultados</th>
                  <th>Primeira DetecÃ§Ã£o</th>
                </tr>
              </thead>
              <tbody id="vulnTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ====================== -->
      <!-- TAB: HOSTS             -->
      <!-- ====================== -->
      <div id="hosts" class="tab-content">
        <div class="filter-section">
          <h3>Busca de Servidores</h3>
          <div class="filter-group-single">
            <input type="text" id="searchHost" placeholder="ğŸ” Buscar servidor (ex: SAP29, pratika, 10.62...)" onkeyup="filterHosts()">
            <button class="btn btn-secondary" onclick="clearHostSearch()">ğŸ—‘ï¸ Limpar Busca</button>
            <button class="btn" onclick="exportHosts()">ğŸ“¥ Exportar Hosts (CSV)</button>
          </div>
        </div>

        <div class="chart-container">
          <h2>Lista de Hosts (<span id="hostCount">0</span> de <span id="hostTotal">0</span>)</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>IP</th>
                  <th>DNS</th>
                  <th>NetBIOS</th>
                  <th>Tags</th>
                  <th>NÂ° Vuln. (C/A/M)</th>
                  <th>OS</th>
                  <th>Ãšltimo Scan</th>
                </tr>
              </thead>
              <tbody id="hostTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ====================== -->
      <!-- TAB: SCANS             -->
      <!-- ====================== -->
      <div id="scans" class="tab-content">
        <div class="chart-container">
          <h2>Lista de Scans (<span id="scanCount">0</span>)</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ReferÃªncia</th>
                  <th>TÃ­tulo</th>
                  <th>Tipo</th>
                  <th>Data de ExecuÃ§Ã£o</th>
                  <th>Estado</th>
                  <th>Alvo</th>
                </tr>
              </thead>
              <tbody id="scanTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ====================== -->
      <!-- TAB: API EXPLORER      -->
      <!-- ====================== -->
      <div id="api" class="tab-content">
        <div class="chart-container">
          <h2>API Explorer</h2>
          <div class="filter-group-single" style="margin-bottom: 20px;">
            <select id="apiEndpoint" style="flex-grow: 1;">
              <option value="/api/health">GET /api/health (Health Check)</option>
              <option value="/api/dashboard/summary">GET /api/dashboard/summary</option>
              <option value="/api/vulnerabilities">GET /api/vulnerabilities</option>
              <option value="/api/hosts">GET /api/hosts</option>
              <option value="/api/scans">GET /api/scans</option>
            </select>
            <button class="btn" onclick="testApiEndpoint()">ğŸš€ Executar</button>
          </div>
          <pre id="apiResponse" class="json-viewer">
            Selecione um endpoint e clique em Executar
          </pre>
        </div>
      </div>

    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>
